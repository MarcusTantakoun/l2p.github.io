<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>l2p.utils.pddl_validator - l2p</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">l2p</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">l2p</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l2p.html">L2P</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paper_recreations.html">Paper Recreations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../paper_feed.html">Paper Feed</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for l2p.utils.pddl_validator</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file contains collection of functions PDDL syntax validations</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pddl_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_params</span><span class="p">,</span> <span class="n">parse_new_predicates</span><span class="p">,</span> <span class="n">parse_predicates</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pddl_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Predicate</span>


<div class="viewcode-block" id="SyntaxValidator">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SyntaxValidator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unsupported_keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># current error types available</span>
        <span class="n">default_error_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;invalid_header&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invalid_keyword_usage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unsupported_keywords&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invalid_param_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invalid_predicate_name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invalid_predicate_format&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invalid_predicate_usage&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">default_unsupported</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;forall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;when&quot;</span><span class="p">,</span>
            <span class="s2">&quot;exists&quot;</span><span class="p">,</span>
            <span class="s2">&quot;implies&quot;</span><span class="p">,</span>
        <span class="p">]</span>  <span class="c1"># current unsupported usage of PDDL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_types</span> <span class="o">=</span> <span class="n">default_error_types</span> <span class="k">if</span> <span class="n">error_types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">error_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsupported_keywords</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">default_unsupported</span>
            <span class="k">if</span> <span class="n">unsupported_keywords</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">unsupported_keywords</span>
        <span class="p">)</span>

    <span class="c1"># PARAMETER CHECKS</span>

<div class="viewcode-block" id="SyntaxValidator.validate_params">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks whether a PDDL action parameter contains types found in object types.&quot;&quot;&quot;</span>
        
        <span class="n">types</span> <span class="o">=</span> <span class="n">types</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="c1"># If no types are defined, inform the user and check for parameter types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">feedback_msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The parameter `</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">` has an object type `</span><span class="si">{</span><span class="n">param_type</span><span class="si">}</span><span class="s1">` &#39;</span>
                        <span class="s1">&#39;while no types are defined. Please remove the object type from this parameter.&#39;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>
            
            <span class="c1"># if all parameter names do not contain a type</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;PASS: All parameters are valid.&quot;</span>

        <span class="c1"># Otherwise, check that parameter types are valid in the given types</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">param_type</span> <span class="ow">in</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;There is an invalid object type `</span><span class="si">{</span><span class="n">param_type</span><span class="si">}</span><span class="s1">` for the parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1"> not found in the types </span><span class="si">{</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">. If you need to use a new type, you can emulate it with an &quot;is_</span><span class="se">{{</span><span class="s1">type</span><span class="se">}}</span><span class="s1"> ?o - object&quot; precondition. Please revise the PDDL model to fix this error.&#39;</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: All parameter types found in object types.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


    <span class="c1"># PREDICATE CHECKS</span>

<div class="viewcode-block" id="SyntaxValidator.validate_types_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_types_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_types_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if predicate name is found within any type definitions&quot;&quot;&quot;</span>
        
        <span class="c1"># Handle the case where types is None or empty</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">types</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: All predicate names are unique to object type names&quot;</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">invalid_predicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="n">pred_name</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">type_key</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># extract the actual type name, disregarding hierarchical or descriptive parts</span>
                <span class="n">type_name</span> <span class="o">=</span> <span class="n">type_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="c1"># check if the predicate name is exactly the same as the type name</span>
                <span class="k">if</span> <span class="n">pred_name</span> <span class="o">==</span> <span class="n">type_name</span><span class="p">:</span>
                    <span class="n">invalid_predicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invalid_predicates</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;ERROR: The following predicate(s) have the same name(s) as existing object types:&quot;</span>
            <span class="k">for</span> <span class="n">pred_i</span><span class="p">,</span> <span class="n">pred_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">invalid_predicates</span><span class="p">):</span>
                <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">pred_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">pred_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please rename these predicates.&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: All predicate names are unique to object type names&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_duplicate_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_duplicate_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_duplicate_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">curr_predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">],</span> <span class="n">new_predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if predicates have the same name but different parameters&quot;&quot;&quot;</span>

        <span class="n">curr_pred_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">pred</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">curr_predicates</span><span class="p">}</span>

        <span class="n">duplicated_predicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">new_pred</span> <span class="ow">in</span> <span class="n">new_predicates</span><span class="p">:</span>
            <span class="c1"># check if the name is already used</span>
            <span class="k">if</span> <span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">curr_pred_dict</span><span class="p">:</span>

                <span class="n">curr</span> <span class="o">=</span> <span class="n">curr_pred_dict</span><span class="p">[</span><span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curr</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">t1</span> <span class="o">!=</span> <span class="n">t2</span> <span class="k">for</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curr</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">],</span> <span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">])]</span>
                <span class="p">):</span>
                    <span class="c1"># if the params are the same, then it&#39;s not a problem</span>
                    <span class="n">duplicated_predicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">],</span>
                            <span class="n">curr_pred_dict</span><span class="p">[</span><span class="n">new_pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="s2">&quot;raw&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicated_predicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The following predicate(s) have the same name(s) as existing predicate(s):&quot;</span>
            <span class="k">for</span> <span class="n">pred_i</span><span class="p">,</span> <span class="n">duplicated_pred_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">duplicated_predicates</span><span class="p">):</span>
                <span class="n">new_pred_full</span><span class="p">,</span> <span class="n">existing_pred_full</span> <span class="o">=</span> <span class="n">duplicated_pred_info</span>
                <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">pred_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">new_pred_full</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">; existing predicate with the same name: </span><span class="si">{</span><span class="n">existing_pred_full</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">You should reuse existing predicates whenever possible. If you are reusing existing predicate(s), you shouldn&#39;t list them under &#39;New Predicates&#39;. If existing predicates are not enough and you are devising new predicate(s), please use names that are different from existing ones.&quot;</span>
            <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Please revise the PDDL model to fix this error.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="s2">&quot;Parameters:&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: All predicates are unique to each other.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_format_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_format_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_format_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks for any PDDL syntax found within predicates&quot;&quot;&quot;</span>

        <span class="n">all_invalid_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="n">pred_def</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;: &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pred_def</span> <span class="o">=</span> <span class="n">pred_def</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; ()`&quot;</span><span class="p">)</span>  <span class="c1"># discard parentheses and similar</span>
            <span class="n">split_predicate</span> <span class="o">=</span> <span class="n">pred_def</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># discard the predicate name</span>
            <span class="n">split_predicate</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">split_predicate</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">split_predicate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;?&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are syntax errors in the definition of the new predicate </span><span class="si">{</span><span class="n">pred_def</span><span class="si">}</span><span class="s2">. Check for any missing &#39;?&#39; variables, or missing type declarations. Please revise its definition and output the entire PDDL action model again. Note that you need to strictly follow the syntax of PDDL.&quot;</span>
                        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_predicate</span><span class="p">)</span>
                            <span class="ow">or</span> <span class="n">split_predicate</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-&quot;</span>
                        <span class="p">):</span>
                            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are syntax errors in the definition of the new predicate </span><span class="si">{</span><span class="n">pred_def</span><span class="si">}</span><span class="s2">. Please revise its definition and output the entire PDDL action model again. Note that you need to define the object type of each parameter and strictly follow the syntax of PDDL.&quot;</span>
                            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_predicate</span><span class="p">):</span>
                            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are syntax errors in the definition of the new predicate </span><span class="si">{</span><span class="n">pred_def</span><span class="si">}</span><span class="s2">. Please revise its definition and output the entire PDDL action model again. Note that you need to define the object type of each parameter and strictly follow the syntax of PDDL.&quot;</span>
                            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

                        <span class="n">param_obj_type</span> <span class="o">=</span> <span class="n">split_predicate</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                        <span class="c1"># Extract the base type names from the keys in types</span>
                        <span class="n">valid_types</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">type_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">type_key</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="p">}</span>

                        <span class="c1"># Check if the parameter object type is in the set of valid types</span>
                        <span class="k">if</span> <span class="n">param_obj_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_types</span><span class="p">:</span>
                            <span class="n">all_invalid_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">param_obj_type</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pred_def</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">all_invalid_params</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;There are invalid object types in the predicates:&quot;</span>
            <span class="k">for</span> <span class="n">param_obj_type</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pred_def</span> <span class="ow">in</span> <span class="n">all_invalid_params</span><span class="p">:</span>
                <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">- `</span><span class="si">{</span><span class="n">param_obj_type</span><span class="si">}</span><span class="s2">` for the parameter `</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">` in the definition of the predicate `</span><span class="si">{</span><span class="n">pred_def</span><span class="si">}</span><span class="s2">` not found in types: </span><span class="si">{</span><span class="n">valid_types</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">feedback_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please revise these definitions and output the entire PDDL action model again.&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: All predicates are formatted correctly.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_pddl_usage_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_pddl_usage_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_pddl_usage_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pddl</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">],</span>
        <span class="n">action_params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">part</span><span class="o">=</span><span class="s2">&quot;preconditions&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function checks three types of errors:</span>
<span class="sd">            - (i) check if the num of params given matches the num of params in predicate definition</span>
<span class="sd">            - (ii) check if there is any param that is not listed under `Parameters:`</span>
<span class="sd">            - (iii) check if the param type matches that in the predicate definition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_ordinal_suffix</span><span class="p">(</span><span class="n">_num</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;st&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;nd&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;rd&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_num</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;th&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;th&quot;</span>
            <span class="p">)</span>

        <span class="n">pred_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">predicates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicates</span><span class="p">))}</span>
        <span class="n">pddl_elems</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pddl</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pddl_elems</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pddl_elems</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pddl_elems</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pddl_elems</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pred_names</span><span class="p">:</span>

                    <span class="n">curr_pred_name</span> <span class="o">=</span> <span class="n">pddl_elems</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">curr_pred_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="n">target_pred_info</span> <span class="o">=</span> <span class="n">predicates</span><span class="p">[</span><span class="n">pred_names</span><span class="p">[</span><span class="n">curr_pred_name</span><span class="p">]]</span>

                    <span class="c1"># read params</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pddl_elems</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pddl_elems</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                        <span class="n">curr_pred_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pddl_elems</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># (i) check if the num of params are correct</span>
                    <span class="n">n_expected_param</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_pred_info</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">n_expected_param</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curr_pred_params</span><span class="p">):</span>

                        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;In the </span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s1">, the predicate `</span><span class="si">{</span><span class="n">curr_pred_name</span><span class="si">}</span><span class="s1">` requires </span><span class="si">{</span><span class="n">n_expected_param</span><span class="si">}</span><span class="s1"> parameters but </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">curr_pred_params</span><span class="p">)</span><span class="si">}</span><span class="s1"> parameters were provided. Object type should not be declared in the </span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s1">, but just the variable. For example, &quot;(drive ?a ?from)&quot; does not contain its object types, just variables. Do not change the predicates. Please revise the PDDL model to fix this error.&#39;</span>
                        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

                    <span class="c1"># (ii) check if there is any unknown param</span>
                    <span class="k">for</span> <span class="n">curr_param</span> <span class="ow">in</span> <span class="n">curr_pred_params</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">curr_param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In the </span><span class="si">{</span><span class="n">part</span><span class="si">}</span><span class="s2"> and in the predicate `</span><span class="si">{</span><span class="n">curr_pred_name</span><span class="si">}</span><span class="s2">`, there is an unknown parameter `</span><span class="si">{</span><span class="n">curr_param</span><span class="si">}</span><span class="s2">`. You should define all parameters (i.e., name and type) under the `### Action Parameters` list. Please revise the PDDL model to fix this error (and other potentially similar errors).&quot;</span>
                            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

                    <span class="c1"># (iii) check if the object types are correct</span>
                    <span class="n">target_param_types</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">target_pred_info</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="n">t_p</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">t_p</span> <span class="ow">in</span> <span class="n">target_pred_info</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="k">for</span> <span class="n">param_idx</span><span class="p">,</span> <span class="n">target_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_param_types</span><span class="p">):</span>
                        <span class="n">curr_param</span> <span class="o">=</span> <span class="n">curr_pred_params</span><span class="p">[</span><span class="n">param_idx</span><span class="p">]</span>
                        <span class="n">claimed_type</span> <span class="o">=</span> <span class="n">action_params</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">curr_param</span><span class="p">]</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_type</span><span class="p">(</span><span class="n">target_type</span><span class="p">,</span> <span class="n">claimed_type</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
                            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There is a syntax error in the </span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">, the </span><span class="si">{</span><span class="n">param_idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">get_ordinal_suffix</span><span class="p">(</span><span class="n">param_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> parameter of `</span><span class="si">{</span><span class="n">curr_pred_name</span><span class="si">}</span><span class="s2">` should be a `</span><span class="si">{</span><span class="n">target_type</span><span class="si">}</span><span class="s2">` but a `</span><span class="si">{</span><span class="n">claimed_type</span><span class="si">}</span><span class="s2">` was given. Please use the correct predicate or devise new one(s) if needed (but note that you should use existing predicates as much as possible).&quot;</span>
                            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: all correct use of predicates.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_usage_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_usage_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_usage_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">curr_predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">],</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function performs very basic check over whether the predicates are used in a valid way.</span>
<span class="sd">            This check should be performed at the end.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># parse predicates</span>
        <span class="n">new_predicates</span> <span class="o">=</span> <span class="n">parse_new_predicates</span><span class="p">(</span><span class="n">llm_response</span><span class="p">)</span>
        <span class="n">curr_predicates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_predicates</span><span class="p">)</span>
        <span class="n">curr_predicates</span> <span class="o">=</span> <span class="n">parse_predicates</span><span class="p">(</span><span class="n">curr_predicates</span><span class="p">)</span>

        <span class="c1"># get action params</span>
        <span class="n">params_info</span> <span class="o">=</span> <span class="n">parse_params</span><span class="p">(</span><span class="n">llm_response</span><span class="p">)</span>

        <span class="c1"># check preconditions</span>
        <span class="n">precond_str</span> <span class="o">=</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Preconditions&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">precond_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">precond_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot; ( &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot; ) &quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">validation_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_pddl_usage_predicates</span><span class="p">(</span>
            <span class="n">precond_str</span><span class="p">,</span> <span class="n">curr_predicates</span><span class="p">,</span> <span class="n">params_info</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s2">&quot;preconditions&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">validation_info</span>

        <span class="c1"># check effects</span>
        <span class="k">if</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Effects&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;invalid_predicate_usage&quot;</span>
        <span class="n">eff_str</span> <span class="o">=</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Effects&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">eff_str</span> <span class="o">=</span> <span class="n">eff_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot; ( &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot; ) &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_pddl_usage_predicates</span><span class="p">(</span>
            <span class="n">eff_str</span><span class="p">,</span> <span class="n">curr_predicates</span><span class="p">,</span> <span class="n">params_info</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s2">&quot;effects&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_overflow_predicates">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_overflow_predicates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_overflow_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if LLM output contains too many predicates in precondition/effects (based on users assigned limit)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Preconditions:&quot;</span> <span class="ow">in</span> <span class="n">llm_response</span><span class="p">,</span> <span class="n">llm_response</span>
        <span class="n">precond_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Preconditions:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">precond_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;FAIL: You seem to have generated an action model with an unusually long list of preconditions. Please include only the relevant preconditions/effects and keep the action model concise.</span><span class="se">\n\n</span><span class="s2">Parameters:&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">eff_str</span> <span class="o">=</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Effects&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eff_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;FAIL: You seem to have generated an action model with an unusually long list of effects. Please include only the relevant preconditions/effects and keep the action model concise.</span><span class="se">\n\n</span><span class="s2">Parameters:&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: predicate output is fine.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_task_objects">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_task_objects">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_task_objects</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters:</span>
<span class="sd">            - objects (dict[str,str]): a dictionary of the task objects.</span>
<span class="sd">            - types (dict[str,str]): a dictionary of the domain types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - check, feedback_msg (bool, str)</span>

<span class="sd">        Checks following cases:</span>
<span class="sd">            (i) if object type is the same as type</span>
<span class="sd">            (ii) if object name is the same as type</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">feedback_msgs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">obj_type_found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">type_key</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="n">current_type</span><span class="p">,</span> <span class="n">parent_type</span> <span class="o">=</span> <span class="n">type_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)</span>

                <span class="c1"># checks if obj_type is found in types</span>
                <span class="k">if</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="n">current_type</span> <span class="ow">or</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="n">parent_type</span><span class="p">:</span>
                    <span class="n">obj_type_found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># checks if obj_name matches either current_type or parent_type</span>
                <span class="k">if</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="n">current_type</span><span class="p">:</span>
                    <span class="n">feedback_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;ERROR: Object variable &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39; matches the type name &#39;</span><span class="si">{</span><span class="n">current_type</span><span class="si">}</span><span class="s2">&#39;, change it to be unique from types: </span><span class="si">{</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">obj_name</span> <span class="o">==</span> <span class="n">parent_type</span><span class="p">:</span>
                    <span class="n">feedback_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;ERROR: Object variable &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39; matches the type name &#39;</span><span class="si">{</span><span class="n">parent_type</span><span class="si">}</span><span class="s2">&#39;, change it to be unique from types: </span><span class="si">{</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

            <span class="c1"># clause that checks if obj_type is found in types</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj_type_found</span><span class="p">:</span>
                <span class="n">feedback_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR: Object variable &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39; has an invalid type &#39;</span><span class="si">{</span><span class="n">obj_type</span><span class="si">}</span><span class="s2">&#39; not found in types: </span><span class="si">{</span><span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">feedback_msgs</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span> <span class="k">else</span> <span class="s2">&quot;PASS: all objects are valid.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_task_states">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_task_states">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_task_states</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="n">objects</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Predicate</span><span class="p">],</span>
        <span class="n">state_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;initial&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters:</span>
<span class="sd">            - states (list[dict[str,str]]): a list of dictionaries of the state states.</span>
<span class="sd">            - parameters (OrderedDict): parameters of the current action.</span>
<span class="sd">            - types (dict[str,str]): a dictionary of the domain types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - check, feedback_msg (bool, str)</span>

<span class="sd">        Checks following cases:</span>
<span class="sd">            (i) if predicates in states are found in predicates in domain</span>
<span class="sd">            (ii) if object variables in states are found in task object list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">feedback_msgs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through each state</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>

            <span class="c1"># (i) check if predicates in states are found in predicates in domain</span>
            <span class="n">matched_preds</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">state_name</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>  <span class="c1"># retrieve predicate name from state</span>

            <span class="c1"># loop through each predicate name from domain</span>
            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
                <span class="c1"># check if predicate in state is found in predicate domain</span>
                <span class="k">if</span> <span class="n">state_name</span> <span class="o">==</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
                    <span class="n">matched_preds</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># if no matches, then that state is missusing a predicate - not found in domain</span>
            <span class="k">if</span> <span class="n">matched_preds</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">feedback_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR: In the </span><span class="si">{</span><span class="n">state_type</span><span class="si">}</span><span class="s2"> state, &#39;(</span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">)&#39; contains &#39;</span><span class="si">{</span><span class="n">state_name</span><span class="si">}</span><span class="s2">&#39; predicate, which is not found in </span><span class="si">{</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">predicates</span><span class="p">]</span><span class="si">}</span><span class="s2">, predicate in state is missused.&quot;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># (ii) check if object variables in states are found in task object list</span>
            <span class="n">state_params</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>  <span class="c1"># retrieve variables from state</span>

            <span class="c1"># loop through each parameter in current state</span>
            <span class="k">for</span> <span class="n">state_p</span> <span class="ow">in</span> <span class="n">state_params</span><span class="p">:</span>

                <span class="n">matched_params</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># check if parameter is found in object names</span>
                    <span class="k">if</span> <span class="n">state_p</span> <span class="o">==</span> <span class="n">obj_name</span><span class="p">:</span>
                        <span class="n">matched_params</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">matched_params</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">feedback_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;ERROR: In the </span><span class="si">{</span><span class="n">state_type</span><span class="si">}</span><span class="s2"> state, &#39;(</span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">)&#39; contains parameter &#39;</span><span class="si">{</span><span class="n">state_p</span><span class="si">}</span><span class="s2">&#39; not found in &#39;</span><span class="si">{</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">feedback_msgs</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span> <span class="k">else</span> <span class="s2">&quot;PASS: all objects are valid.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">valid</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_header">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_header">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if domain headers and formatted code block syntax are found in LLM output&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Parameters&quot;</span><span class="p">,</span> <span class="s2">&quot;Preconditions&quot;</span><span class="p">,</span> <span class="s2">&quot;Effects&quot;</span><span class="p">,</span> <span class="s2">&quot;New Predicates&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">header</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">llm_response</span><span class="p">:</span>
                <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;FAIL: The header `</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">` is missing in the PDDL model. Please include the header `</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">` in the PDDL model.&quot;</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Parameters&quot;</span><span class="p">,</span> <span class="s2">&quot;Preconditions&quot;</span><span class="p">,</span> <span class="s2">&quot;Effects&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;##&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">feedback_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;FAIL: The header `</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s1">` is missing in the formalised code block. Please include a &quot;```&quot; section in the </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s1"> section.&#39;</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: headers are identified properly in LLM output.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_unsupported_keywords">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_unsupported_keywords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_unsupported_keywords</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unsupported_keywords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks whether PDDL model uses unsupported logic keywords&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unsupported_keywords</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">llm_response</span><span class="p">:</span>
                <span class="n">feedback_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ERROR: The precondition or effect contains the keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: Unsupported keywords not found in PDDL model.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_keyword_usage">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_keyword_usage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_keyword_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if action effects uses unsupported universal condition keywords&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Action Effects&quot;</span> <span class="ow">in</span> <span class="n">llm_response</span><span class="p">:</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span>
        <span class="n">heading</span> <span class="o">=</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Action Effects&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;```</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;forall&quot;</span><span class="p">,</span> <span class="s2">&quot;exists&quot;</span><span class="p">,</span> <span class="s2">&quot;if &quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">heading</span><span class="p">:</span>
                <span class="n">feedback_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The keyword `</span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2">` is not supported in the action effects.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: unsupported keywords are not found in the action effects.&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_new_action_creation">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_new_action_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_new_action_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the LLM attempts to create a new action (so two or more actions defined in the same response)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">llm_response</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;## Action Parameters&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="ow">or</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;## Preconditions&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="ow">or</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;## Effects&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="ow">or</span> <span class="n">llm_response</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;## New Predicates&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;It&#39;s not possible to create new actions at this time. Please only define the requested action.&quot;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">feedback_msg</span>

        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="s2">&quot;PASS: no new actions created&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">feedback_msg</span></div>


<div class="viewcode-block" id="SyntaxValidator.validate_type">
<a class="viewcode-back" href="../../../l2p.html#l2p.utils.pddl_validator.SyntaxValidator.validate_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">claimed_type</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the claimed_type is valid for the target_type according to the type hierarchy.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            - target_type (str): The type that is expected for the parameter.</span>
<span class="sd">            - claimed_type (str): The type that is provided in the PDDL.</span>
<span class="sd">            - types (dict[str, str]): A dictionary mapping subtypes to their supertypes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - bool: True if claimed_type is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the claimed type matches the target type</span>
        <span class="k">if</span> <span class="n">claimed_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Iterate through the types hierarchy to check if claimed_type is a subtype of target_type</span>
        <span class="n">current_type</span> <span class="o">=</span> <span class="n">claimed_type</span>

        <span class="c1"># Extract all types from the keys in the types dictionary</span>
        <span class="n">all_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">type_hierarchy</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">main_type</span><span class="p">,</span> <span class="o">*</span><span class="n">subtype</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)</span>
            <span class="n">all_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">main_type</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">subtype</span><span class="p">:</span>
                <span class="n">all_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">type_hierarchy</span><span class="p">[</span><span class="n">subtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">main_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">current_type</span> <span class="ow">in</span> <span class="n">all_types</span><span class="p">:</span>
            <span class="c1"># find the key that starts with the current type</span>

            <span class="n">parent_type_entry</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_type</span><span class="si">}</span><span class="s2"> - &quot;</span><span class="p">)),</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">parent_type_entry</span><span class="p">:</span>
                <span class="c1"># extract the parent type from the key</span>
                <span class="n">super_type</span> <span class="o">=</span> <span class="n">parent_type_entry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">super_type</span> <span class="o">==</span> <span class="n">target_type</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="n">current_type</span> <span class="o">=</span> <span class="n">super_type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="kc">False</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Marcus Tantakoun
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=000c92bf"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>